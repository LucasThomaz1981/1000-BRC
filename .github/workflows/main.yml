name: 1000-BRC Varredura de Arquivos - 20 Works

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'

jobs:
  file_scan:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        worker: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
      max-parallel: 1 
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Instalar DependÃªncias
        run: pip install requests bitcoinlib

      - name: Executar Varredura de Arquivos
        run: |
          echo "Worker ${{ matrix.worker }} iniciando varredura de chaves..."
          python3 api_broadcast_system.py > output.txt
          
          # Processa os HEX gerados e envia para a Blockchain.com / ViaBTC
          grep "HEX_GEN:" output.txt | cut -d':' -f2 | while read HEX; do
            if [ -n "$HEX" ]; then
              echo "ðŸš€ TransaÃ§Ã£o encontrada! Enviando Broadcast..."
              # Tentativa 1: ViaBTC (Mais estÃ¡vel para scripts)
              curl -s -X POST https://www.viabtc.com/res/tools/v1/broadcast -d "raw_tx=$HEX"
              # Tentativa 2: Blockchain.com API (Fallback)
              curl -s -X POST https://api.blockchain.info/pushtx -d "tx=$HEX"
            fi
          done
          
